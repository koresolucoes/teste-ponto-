<div class="flex flex-col items-center min-h-screen p-4 sm:p-6 lg:p-8 bg-slate-900 text-slate-200 relative">
  @if (employee(); as emp) {
    <div class="w-full max-w-4xl mx-auto">
      <!-- Header -->
      <header class="text-center mb-8 flex flex-col items-center">
        @if (emp.photo_url) {
          <img [src]="emp.photo_url" [alt]="emp.name" loading="lazy" class="w-24 h-24 rounded-full object-cover mb-4 shadow-lg">
        } @else {
          <div [class]="'w-24 h-24 rounded-full flex items-center justify-center text-white text-4xl font-bold mb-4 shadow-lg ' + getAvatarColor(emp.name)">
            {{ getInitials(emp.name) }}
          </div>
        }
        <h1 class="text-3xl font-bold text-white">Olá, {{ emp.name.split(' ')[0] }}!</h1>
        @if (pontoResponse(); as resp) {
          <div class="mt-4 flex items-center gap-3 bg-emerald-900/50 border border-emerald-700 text-emerald-300 px-6 py-3 rounded-lg">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
            </svg>
            <p class="text-xl font-semibold">{{ getSuccessMessage(resp.status) }}</p>
          </div>
        }
      </header>

      <!-- History Section -->
      <main class="bg-slate-800 rounded-lg shadow-xl p-4 sm:p-6 overflow-hidden flex flex-col" style="height: calc(100vh - 300px); max-height: 600px;">
        <h2 class="text-2xl font-bold text-white mb-4 border-b border-slate-700 pb-3">Histórico de Ponto (Últimos 7 dias)</h2>
        
        <div class="flex-grow overflow-y-auto pr-2">
          @if (loading()) {
            <div class="flex justify-center items-center h-full">
              <svg class="animate-spin h-8 w-8 text-sky-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </div>
          } @else if (error()) {
            <div class="text-center py-10 px-4 bg-rose-900/50 rounded-lg">
              <p class="font-semibold text-rose-300">{{ error() }}</p>
            </div>
          } @else if (groupedHistory().length > 0) {
            <div class="space-y-6">
              @for(group of groupedHistory(); track group[0]) {
                <div>
                  <h3 class="font-bold text-lg text-sky-400 mb-2">{{ group[0] | date:'EEEE, d \'de\' MMMM \'de\' yyyy':'':'pt-BR' }}</h3>
                  <ul class="space-y-2">
                    @for(entry of group[1]; track entry.id) {
                       <li class="bg-slate-700/50 p-3 rounded-lg flex justify-between items-center gap-4">
                        <div class="flex items-center gap-3">
                            <span class="font-mono text-lg bg-slate-900 px-2 py-1 rounded">{{ entry.clock_in_time | date:'HH:mm':'UTC' }}</span>
                            <span>&#8594;</span>
                            <span class="font-mono text-lg bg-slate-900 px-2 py-1 rounded">{{ entry.clock_out_time ? (entry.clock_out_time | date:'HH:mm':'UTC') : '--:--' }}</span>
                        </div>
                        <div class="text-right">
                            <span class="font-semibold text-slate-300">{{ getDuration(entry.clock_in_time, entry.clock_out_time) }}</span>
                        </div>
                      </li>
                    }
                  </ul>
                </div>
              }
            </div>
          } @else {
            <div class="text-center py-10">
              <p class="text-slate-400">Nenhum registro de ponto encontrado nos últimos 7 dias.</p>
            </div>
          }
        </div>
      </main>

       <!-- Footer and Logout -->
      <footer class="mt-8 text-center">
        <button (click)="logout()" class="bg-sky-600 text-white font-bold py-3 px-8 rounded-lg text-lg hover:bg-sky-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-900 focus:ring-sky-500 transition-colors duration-200">
          Sair
        </button>
      </footer>
    </div>
  }

  <!-- Auto-logout progress bar -->
  <div class="absolute bottom-0 left-0 h-1.5 bg-slate-700 w-full">
    <div class="progress-bar h-full bg-sky-500"></div>
  </div>
</div>
